<style>
  .chart-container {
    width: 100%;
    max-width: 500px; /* Taille maximale du graphique */
    height: 300px; /* Hauteur fixe */
    margin: 0 auto; /* Centrer le graphique */
    display: block;
  }
</style>

{% extends "base.html" %}
{% block content %}
<h2 class="mb-4">Statistiques de la plateforme</h2>
<div class="row g-4 mb-4">
  <div class="col-md-3">
    <div class="card shadow-sm text-center">
      <div class="card-body">
        <h5 class="card-title">Tickets total</h5>
        <p class="display-6 fw-bold text-primary">{{ total_tickets }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center">
      <div class="card-body">
        <h5 class="card-title">Ouverts</h5>
        <p class="display-6 fw-bold text-info">{{ tickets_ouverts }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center">
      <div class="card-body">
        <h5 class="card-title">Résolus</h5>
        <p class="display-6 fw-bold text-success">{{ tickets_resolus }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card shadow-sm text-center">
      <div class="card-body">
        <h5 class="card-title">En attente</h5>
        <p class="display-6 fw-bold text-warning">{{ tickets_en_attente }}</p>
      </div>
    </div>
  </div>
</div>

<div class="row mt-5">
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Répartition des tickets par statut</h5>
  <canvas id="statutChart" class="chart-same-size"></canvas>
      </div>
    </div>
  </div>
  <div class="col-md-6 mb-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Tickets par technicien</h5>
  <canvas id="technicienChart" class="chart-same-size"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-md-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Évolution mensuelle des tickets</h5>
        <canvas id="evolutionChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Graphiques supplémentaires -->
  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Répartition des tickets</h5>
          <div class="chart-container">
            <canvas id="repartitionChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Tickets par technicien</h5>
          <canvas id="technicienChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<<<<<<< HEAD
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Statut Doughnut Chart
const statutCtx = document.getElementById('statutChart').getContext('2d');
new Chart(statutCtx, {
  type: 'doughnut',
  data: {
    labels: {{ stat_labels|safe }},
    datasets: [{
      data: {{ stat_counts|safe }},
      backgroundColor: [
        'rgba(13,110,253,0.8)', // bleu
        'rgba(255,193,7,0.8)',  // jaune
        'rgba(25,135,84,0.8)'   // vert
      ],
      borderColor: [
        'rgba(13,110,253,1)',
        'rgba(255,193,7,1)',
        'rgba(25,135,84,1)'
      ],
      borderWidth: 2
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { position: 'bottom' },
      tooltip: { enabled: true }
    },
    layout: { padding: 20 }
  }
});
=======
<!-- Script Chart.js pour les graphiques -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Tickets Line Chart
  var ctx = document.getElementById('ticketsChart').getContext('2d');
  var ticketsChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ month_labels|safe }},
      datasets: [{
        label: 'Tickets créés',
        data: {{ month_counts|safe }},
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        fill: true
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: true
        }
      }
    }
  });
>>>>>>> 9bad7e70be411de93cf38b1019500438498c6c65

  // Répartition des tickets (Pie Chart)
  var repartitionCtx = document.getElementById('repartitionChart').getContext('2d');
  new Chart(repartitionCtx, {
    type: 'pie',
    data: {
      labels: {{ stat_labels|safe }},
      datasets: [{
        data: {{ stat_counts|safe }},
        backgroundColor: [
          'rgba(13,110,253,0.8)', // bleu
          'rgba(255,193,7,0.8)',  // jaune
          'rgba(25,135,84,0.8)'   // vert
        ],
        borderColor: [
          'rgba(13,110,253,1)',
          'rgba(255,193,7,1)',
          'rgba(25,135,84,1)'
        ],
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true, // Maintenir le ratio d'aspect
      plugins: {
        legend: { position: 'bottom' },
        tooltip: { enabled: true }
      },
      layout: { padding: 20 }
    }
  });

  // Technicien Bar Chart
  const techCtx = document.getElementById('technicienChart').getContext('2d');
  new Chart(techCtx, {
    type: 'bar',
    data: {
      labels: {{ tech_labels|safe }},
      datasets: [{
        label: 'Tickets',
        data: {{ tech_counts|safe }},
        backgroundColor: '#0d6efd',
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
</script>

{% endblock %}
